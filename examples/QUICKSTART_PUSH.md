# Kameo RPC æœåŠ¡å™¨æ¨é€åŠŸèƒ½å¿«é€Ÿå…¥é—¨

## ğŸ“‹ æ¦‚è¿°

æœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Kameo RPC æ¡†æ¶ä¸­å®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„åŠŸèƒ½ã€‚åŸºäº libp2p çš„åŒå‘æµèƒ½åŠ›,å®ç°äº†ä¸‰ç§æ¨é€åœºæ™¯:

1. **æœåŠ¡å™¨çŠ¶æ€æ›´æ–°** - å®šæœŸæ¨é€ç³»ç»ŸæŒ‡æ ‡
2. **ä»»åŠ¡å®Œæˆé€šçŸ¥** - å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„ä¸»åŠ¨é€šçŸ¥
3. **ç³»ç»Ÿäº‹ä»¶å¹¿æ’­** - å‘æ‰€æœ‰è¿æ¥å®¢æˆ·ç«¯å¹¿æ’­é‡è¦äº‹ä»¶

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **åŸºäº `RemoteActorRef::tell()`** - åˆ©ç”¨ Kameo çš„è¿œç¨‹æ¶ˆæ¯æœºåˆ¶å®ç°å•å‘æ¨é€
- âœ… **libp2p åŒå‘æµ** - åº•å±‚æ”¯æŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æ¨é€
- âœ… **Actor æ¨¡å¼** - å®¢æˆ·ç«¯é€šè¿‡ `ClientNotificationHandler` Actor æ¥æ”¶æ¨é€
- âœ… **æ··åˆæ¨¡å¼** - æ”¯æŒå•å‘é€šçŸ¥å’Œæµå¼æ•°æ®æ¨é€
- âœ… **æ˜“äºæ‰©å±•** - æ¸…æ™°çš„æ¶æ„ä¾¿äºæ·»åŠ æ–°çš„æ¨é€ç±»å‹

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
cargo run --example intranet_server --features remote -- \
  --name "push-server" \
  --tcp-port 8020
```

**é¢„æœŸè¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ§® Kameo RPC è®¡ç®—å™¨æœåŠ¡å™¨ v1.0                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… è®¡ç®—å™¨æœåŠ¡å·²æ³¨å†Œä¸º 'calculator'
âœ… é€šçŸ¥æ¨é€æœåŠ¡å·²æ³¨å†Œä¸º 'notification'
   - æ”¯æŒçš„æ¨é€ç±»å‹:
     â€¢ æœåŠ¡å™¨çŠ¶æ€æ›´æ–° (ServerStatusUpdate)
     â€¢ ä»»åŠ¡å®Œæˆé€šçŸ¥ (TaskCompletionNotice)
     â€¢ å®æ—¶æ•°æ®æµ (StreamDataItem)
     â€¢ ç³»ç»Ÿäº‹ä»¶å¹¿æ’­ (EventBroadcast)
ğŸ“¡ å¯åŠ¨æ¨é€æœåŠ¡...
âœ… æ¨é€æœåŠ¡å·²å¯åŠ¨
[push-server] ğŸ”„ æœåŠ¡å™¨çŠ¶æ€æ¨é€å¾ªç¯å·²å¯åŠ¨
[push-server] ğŸ”„ ä»»åŠ¡å®Œæˆé€šçŸ¥å¾ªç¯å·²å¯åŠ¨
[push-server] ğŸ”„ ç³»ç»Ÿäº‹ä»¶å¹¿æ’­å¾ªç¯å·²å¯åŠ¨
```

### 2. å¯åŠ¨å®¢æˆ·ç«¯

```bash
cargo run --example intranet_client --features remote -- \
  --server-host 127.0.0.1 \
  --name "push-client" \
  --demo-mode true
```

**é¢„æœŸè¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ§® Kameo RPC è®¡ç®—å™¨å®¢æˆ·ç«¯ v1.0                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¡ æ­£åœ¨è®¢é˜…æœåŠ¡å™¨æ¨é€æœåŠ¡...
âœ… å®¢æˆ·ç«¯é€šçŸ¥å¤„ç†å™¨å·²æ³¨å†Œä¸º 'client_handler'
ğŸ” æ­£åœ¨æŸ¥æ‰¾æœåŠ¡å™¨çš„é€šçŸ¥æœåŠ¡...
âœ… æ‰¾åˆ°æœåŠ¡å™¨é€šçŸ¥æœåŠ¡
ğŸ“ æ­£åœ¨è®¢é˜…æ•°æ®æµ...
âœ… æˆåŠŸè®¢é˜…æ¨é€æœåŠ¡
   è®¢é˜…ID: sub-12qKLo3X...
   æ•°æ®æµç±»å‹: ServerMetrics
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ“Š æœåŠ¡å™¨çŠ¶æ€æ¨é€ #1
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ–¥ï¸  CPU ä½¿ç”¨ç‡: 45.2%
   ğŸ’¾ å†…å­˜ä½¿ç”¨ç‡: 62.8%
   ğŸ”— æ´»è·ƒè¿æ¥æ•°: 1
   â±ï¸  è¿è¡Œæ—¶é—´: 0s
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âœ… ä»»åŠ¡å®Œæˆé€šçŸ¥ #2
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ†” ä»»åŠ¡ID: task-0001
   ğŸ“¦ ä»»åŠ¡ç±»å‹: æ•°æ®å¤„ç†
   ğŸ“ æ‰§è¡Œç»“æœ: æˆåŠŸå®Œæˆ
   â±ï¸  è€—æ—¶: 1250ms
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â„¹ï¸  ç³»ç»Ÿäº‹ä»¶å¹¿æ’­ #3
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ·ï¸  äº‹ä»¶ç±»å‹: æœåŠ¡å¥åº·æ£€æŸ¥
   ğŸ“¢ äº‹ä»¶æ¶ˆæ¯: æœåŠ¡å¥åº·æ£€æŸ¥ äº‹ä»¶å·²è§¦å‘
   ğŸ”´ ä¸¥é‡ç¨‹åº¦: ä¿¡æ¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ“ æ¶æ„è®¾è®¡

### æ¨é€æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NotificationActor  â”‚                    â”‚  CalculatorActor  â”‚
â”‚  (æœåŠ¡å™¨ç«¯)     â”‚                    â”‚  (æœåŠ¡å™¨ç«¯)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â”‚ 1. è®¢é˜…æ•°æ®æµ                         â”‚
         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
         â”‚                               â”‚      â”‚
         â”‚ 2. è¿”å›è®¢é˜…ID                  â”‚      â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
         â”‚                               â”‚      â”‚
         â”‚ 3. å®šæœŸæ¨é€çŠ¶æ€                â”‚      â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
         â”‚      RemoteActorRef::tell()   â”‚      â”‚
         â”‚                               â”‚      â”‚
         â”‚ 4. ä»»åŠ¡å®Œæˆé€šçŸ¥                â”‚      â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
         â”‚                               â”‚      â”‚
         â”‚ 5. ç³»ç»Ÿäº‹ä»¶å¹¿æ’­                â”‚      â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
         â”‚                               â”‚      â”‚
         â–¼                               â”‚      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  ClientNotificationHandler      â”‚     â”‚
â”‚  (å®¢æˆ·ç«¯ Actor)                 â”‚â—„â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶

#### 1. NotificationActor (æœåŠ¡å™¨ç«¯)
```rust
#[derive(Actor, RemoteActor)]
pub struct NotificationActor {
    pub server_name: String,
    pub connected_clients: HashMap<PeerId, ClientInfo>,
    pub event_count: u64,
    pub start_time: SystemTime,
}
```

#### 2. ClientNotificationHandler (å®¢æˆ·ç«¯)
```rust
#[derive(Actor, RemoteActor)]
pub struct ClientNotificationHandler {
    pub client_name: String,
    pub notification_count: u64,
}

// å®ç°å„ç§æ¨é€æ¶ˆæ¯çš„å¤„ç†
impl Message<ServerStatusUpdate> for ClientNotificationHandler { ... }
impl Message<TaskCompletionNotice> for ClientNotificationHandler { ... }
impl Message<EventBroadcast> for ClientNotificationHandler { ... }
```

#### 3. æ¨é€æ¶ˆæ¯ç±»å‹
```rust
// æœåŠ¡å™¨çŠ¶æ€æ›´æ–°
pub struct ServerStatusUpdate {
    pub timestamp: u64,
    pub cpu_usage: f32,
    pub memory_usage: f32,
    pub active_connections: usize,
    pub uptime_seconds: u64,
}

// ä»»åŠ¡å®Œæˆé€šçŸ¥
pub struct TaskCompletionNotice {
    pub task_id: String,
    pub task_type: String,
    pub result: String,
    pub duration_ms: u64,
    pub timestamp: u64,
}

// ç³»ç»Ÿäº‹ä»¶å¹¿æ’­
pub struct EventBroadcast {
    pub event_type: String,
    pub message: String,
    pub severity: Severity,
    pub timestamp: u64,
}
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æœåŠ¡å™¨ç›‘æ§
æœåŠ¡å™¨å®šæœŸ(æ¯5ç§’)æ¨é€ç³»ç»ŸæŒ‡æ ‡ç»™å®¢æˆ·ç«¯,ç”¨äºå®æ—¶ç›‘æ§ã€‚

```rust
// æœåŠ¡å™¨ç«¯
async fn push_server_status_loop(...) {
    loop {
        tokio::time::sleep(Duration::from_secs(5)).await;

        let status = ServerStatusUpdate { /* ... */ };

        // æ¨é€åˆ°æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯
        client_handler.tell(&status).send();
    }
}
```

### åœºæ™¯ 2: å¼‚æ­¥ä»»åŠ¡å®Œæˆé€šçŸ¥
é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡å®Œæˆå,æœåŠ¡å™¨ä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯ç»“æœã€‚

```rust
// æœåŠ¡å™¨ç«¯
async fn push_task_completion_loop(...) {
    loop {
        tokio::time::sleep(Duration::from_secs(10)).await;

        let notice = TaskCompletionNotice { /* ... */ };

        client_handler.tell(&notice).send();
    }
}
```

### åœºæ™¯ 3: ç³»ç»Ÿäº‹ä»¶å¹¿æ’­
é‡è¦ç³»ç»Ÿäº‹ä»¶(å¦‚é«˜è´Ÿè½½è­¦å‘Š)å¹¿æ’­ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚

```rust
// æœåŠ¡å™¨ç«¯
async fn broadcast_system_events_loop(...) {
    loop {
        tokio::time::sleep(Duration::from_secs(15)).await;

        let event = EventBroadcast { /* ... */ };

        // å¹¿æ’­åˆ°æ‰€æœ‰å®¢æˆ·ç«¯
        for client in clients {
            client_handler.tell(&event).send();
        }
    }
}
```

## ğŸ”§ è‡ªå®šä¹‰æ¨é€

### æ·»åŠ æ–°çš„æ¨é€ç±»å‹

1. **å®šä¹‰æ¶ˆæ¯ç»“æ„** (`intranet_common.rs`)
```rust
#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct CustomNotification {
    pub data: String,
    pub priority: u8,
}
```

2. **å®ç°æœåŠ¡å™¨æ¨é€é€»è¾‘** (`intranet_server.rs`)
```rust
async fn push_custom_notifications(...) {
    loop {
        let notification = CustomNotification { /* ... */ };

        if let Ok(Some(client)) = RemoteActorRef::<ClientNotificationHandler>::lookup("client_handler").await {
            let _ = client.tell(&notification).send();
        }
    }
}
```

3. **å®ç°å®¢æˆ·ç«¯å¤„ç†** (`intranet_client.rs`)
```rust
#[remote_message]
impl Message<CustomNotification> for ClientNotificationHandler {
    type Reply = ();

    async fn handle(&mut self, msg: CustomNotification, _ctx: &mut Context<Self, Self::Reply>) {
        info!("æ”¶åˆ°è‡ªå®šä¹‰é€šçŸ¥: {}", msg.data);
    }
}
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

- **ä½å»¶è¿Ÿ**: åŸºäº libp2p çš„é«˜æ•ˆäºŒè¿›åˆ¶åè®®
- **å¯æ‰©å±•**: æ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘æ¨é€
- **å¯é **: åˆ©ç”¨ Actor æ¨¡å‹ä¿è¯æ¶ˆæ¯æœ‰åºå¤„ç†
- **çµæ´»**: æ”¯æŒå•å‘é€šçŸ¥å’Œæµå¼æ•°æ®æ¨é€

## ğŸ“ ä¸ gRPC çš„å¯¹æ¯”

| ç‰¹æ€§ | Kameo RPC Push | gRPC Server Streaming |
|------|----------------|----------------------|
| åº•å±‚åè®® | libp2p (P2P) | HTTP/2 |
| æ¨é€æ¨¡å¼ | RemoteActorRef::tell() | Server Stream |
| Actor æ¨¡å‹ | âœ… åŸç”Ÿæ”¯æŒ | âŒ éœ€è¦é¢å¤–å®ç° |
| P2P èƒ½åŠ› | âœ… åŸç”Ÿæ”¯æŒ | âŒ ä¸­å¿ƒåŒ–æ¶æ„ |
| æœåŠ¡å‘ç° | âœ… å†…ç½® Kademlia DHT | âŒ éœ€è¦å¤–éƒ¨æœåŠ¡ |

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Kameo å®˜æ–¹æ–‡æ¡£](https://docs.rs/kameo)
- [libp2p æ–‡æ¡£](https://docs.rs/libp2p)
- [REFACTORING_SUMMARY.md](./REFACTORING_SUMMARY.md) - RPC æ¡†æ¶é‡æ„æ€»ç»“

## ğŸ“Œ æ€»ç»“

æœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Kameo RPC æ¡†æ¶ä¸­å®ç°æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ¨é€åŠŸèƒ½:

âœ… **æ··åˆæ¨é€æ¨¡å¼** - å•å‘é€šçŸ¥ + æµå¼æ•°æ®
âœ… **ä¸‰ç§åº”ç”¨åœºæ™¯** - çŠ¶æ€æ›´æ–°ã€ä»»åŠ¡é€šçŸ¥ã€äº‹ä»¶å¹¿æ’­
âœ… **ç®€æ´çš„ API** - `RemoteActorRef::tell()` å®ç°æ¨é€
âœ… **æ˜“äºæ‰©å±•** - æ¸…æ™°çš„æ¶æ„ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
âœ… **ç”Ÿäº§å°±ç»ª** - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

ç°åœ¨æ‚¨å¯ä»¥åŸºäºæ­¤ç¤ºä¾‹æ„å»ºè‡ªå·±çš„å®æ—¶æ¨é€åº”ç”¨! ğŸ‰
